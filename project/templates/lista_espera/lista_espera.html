{% extends 'main.html' %}
{% block head %}
  <link rel="stylesheet" href="{{ url_for('static', filename='./principal/css/principal.css') }}">
  <style>
    .expandable-header {
      cursor: pointer;
    }
    </style>
{% endblock %}
{% block content %}
  <div class="container mt-5">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <div class="card">
          <div class="card-header">Gerenciamento de Lista de Espera</div>
          <div class="card-body">
            <section>
              <h2  class="expandable-header" data-toggle="collapse" data-target="#create-lista-espera-form-container" aria-expanded="false" aria-controls="create-lista-espera-form-container">
                Criar Nova Lista de Espera
              </h2>
              <div class="collapse" id="create-lista-espera-form-container">
                <form id="create-lista-espera-form">
                  <div class="form-group">
                    <label for="codigo">Codigo</label>
                    <input type="text" class="form-control" id="codigo" placeholder="Codigo" required>
                  </div>
                  <div class="form-group">
                    <label for="filial">Filial</label>
                    <input type="text" class="form-control" id="filial" placeholder="Filial" required>
                  </div>
                  <div class="form-group">
                    <label for="curso">Curso</label>
                    <input type="text" class="form-control" id="curso" placeholder="Curso" required>
                  </div>
                  <div class="form-group">
                    <label for="horario">Horario</label>
                    <input type="text" class="form-control" id="horario" placeholder="Horario" required>
                  </div>
                  <div class="form-group">
                    <label for="matricula_prof">Matricula do Professor</label>
                    <input type="number" class="form-control" id="matricula_prof" placeholder="Matricula do Professor" required>
                  </div>
                  <div class="form-group">
                    <label for="num_minimo">Numero Minimo de Alunos</label>
                    <input type="number" class="form-control" id="num_minimo" placeholder="Numero Minimo de Alunos" required>
                  </div>
                  <div class="form-group">
                    <label for="tempo_desde_ultima_adicao">Tempo Desde ultima Adicao (dias)</label>
                    <input type="number" class="form-control" id="tempo_desde_ultima_adicao" placeholder="Tempo Desde ultima Adicao (dias)" required>
                  </div>
                  <button type="submit" class="btn btn-primary mt-3">Criar Lista de Espera</button>
                </form>
              </div>
            </section>
            <section class="mt-5">
              <h2 class="expandable-header" data-toggle="collapse" data-target="#add-aluno-form-container" aria-expanded="false" aria-controls="add-aluno-form-container">
                Adicionar Aluno a Lista de Espera
              </h2>
              <div class="collapse" id="add-aluno-form-container">
                <form id="add-aluno-form">
                  <div class="form-group">
                    <label for="codigo_add">Codigo da Lista de Espera</label>
                    <input type="text" class="form-control" id="codigo_add" placeholder="Codigo da Lista de Espera" required>
                  </div>
                  <div class="form-group">
                    <label for="matrAluno_add">Matricula do Aluno</label>
                    <input type="number" class="form-control" id="matrAluno_add" placeholder="Matricula do Aluno" required>
                  </div>
                  <button type="submit" class="btn btn-primary mt-3">Adicionar Aluno</button>
                </form>
              </div>
            </section>
            <section class="mt-5">
              <h2 class="expandable-header" data-toggle="collapse" data-target="#remove-aluno-form-container" aria-expanded="false" aria-controls="remove-aluno-form-container">
                Remover Aluno da Lista de Espera
              </h2>
              <div class="collapse" id="remove-aluno-form-container">
                <form id="remove-aluno-form">
                  <div class="form-group">
                    <label for="codigo_remove">Codigo da Lista de Espera</label>
                    <input type="text" class="form-control" id="codigo_remove" placeholder="Codigo da Lista de Espera" required>
                  </div>
                  <div class="form-group">
                    <label for="matrAluno_remove">Matricula do Aluno</label>
                    <input type="number" class="form-control" id="matrAluno_remove" placeholder="Matricula do Aluno" required>
                  </div>
                  <button type="submit" class="btn btn-primary mt-3">Remover Aluno</button>
                </form>
              </div>
            </section>
            <section class="mt-5">
              <h2 class="expandable-header" data-toggle="collapse" data-target="#delete-lista-espera-form-container" aria-expanded="false" aria-controls="delete-lista-espera-form-container">
                Excluir Lista de Espera
              </h2>
              <div class="collapse" id="delete-lista-espera-form-container">
                <form id="delete-lista-espera-form">
                  <div class="form-group">
                    <label for="codigo_delete">Codigo da Lista de Espera</label>
                    <input type="text" class="form-control" id="codigo_delete" placeholder="Codigo da Lista de Espera" required>
                  </div>
                  <div class="form-check mt-3">
                    <input type="checkbox" class="form-check-input" id="cria_turma">
                    <label class="form-check-label" for="cria_turma">Criar Turma</label>
                  </div>
                  <button type="submit" class="btn btn-primary mt-3">Excluir Lista de Espera</button>
                </form>
              </div>
            </section>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('create-lista-espera-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const data = {
            codigo: document.getElementById('codigo').value,
            filial: document.getElementById('filial').value,
            curso: document.getElementById('curso').value,
            horario: document.getElementById('horario').value,
            matricula_prof: document.getElementById('matricula_prof').value,
            num_minimo: document.getElementById('num_minimo').value,
            tempo_desde_ultima_adicao: document.getElementById('tempo_desde_ultima_adicao').value
        };
        fetch('/lista_espera/lista_espera', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        }).then(response => response.json())
          .then(data => alert('Lista de Espera criada com sucesso!'))
          .catch(error => console.error('Erro:', error));
    });

    document.getElementById('add-aluno-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const data = {
            matrAluno: document.getElementById('matrAluno_add').value
        };
        const codigo = document.getElementById('codigo_add').value;
        fetch(`/lista_espera/lista_espera/${codigo}/aluno`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        }).then(response => response.json())
          .then(data => alert('Aluno adicionado com sucesso!'))
          .catch(error => console.error('Erro:', error));
    });

    document.getElementById('remove-aluno-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const data = {
            matrAluno: document.getElementById('matrAluno_remove').value
        };
        const codigo = document.getElementById('codigo_remove').value;
        fetch(`/lista_espera/lista_espera/${codigo}/aluno`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        }).then(response => response.json())
          .then(data => alert('Aluno removido com sucesso!'))
          .catch(error => console.error('Erro:', error));
    });

    document.getElementById('delete-lista-espera-form').addEventListener('submit', function(e) {
        e.preventDefault();
        const codigo = document.getElementById('codigo_delete').value;
        const criaTurma = document.getElementById('cria_turma').checked;
        fetch(`/lista_espera/lista_espera/${codigo}?cria_turma=${criaTurma}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => response.json())
          .then(data => alert('Lista de Espera excluida com sucesso!'))
          .catch(error => console.error('Erro:', error));
    });
  </script>
{% endblock %}
{% block scripts %}
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
{% endblock %}
